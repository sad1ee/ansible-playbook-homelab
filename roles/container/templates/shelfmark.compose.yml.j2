services:
  shelfmark:
    image: "ghcr.io/calibrain/shelfmark:latest"

    labels:
      dev.dozzle.group: "Frontend"

    environment:
      UID: "{{ container_puid }}"
      GID: "{{ container_pgid }}"
      TZ: "{{ container_tz }}"
      LOGLEVEL: "info" # debug, info, warning, error, critical
      FLASK_PORT: "{{ container_webui_port.shelfmark }}"
      BOOK_LANGUAGE: "de,en"
      USE_BOOK_TITLE: "true"
      CALIBRE_WEB_URL: "https://cwa.{{ container_domain_base }}"
      INGEST_DIR: "/cwa-book-ingest"

    volumes:
      - "{{ container_path.shelfmark }}:/config"
      - "{{ container_path.calibre.ingest }}:/cwa-book-ingest"

    depends_on:
      gluetun:
        condition: "service_healthy"

    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8084/api/health"]
      interval: "300s"
      timeout: "30s"
      retries: "3"
      start_period: "60s"
      start_interval: "2s"

    container_name: "shelfmark"
    restart: "unless-stopped"

    network_mode: "service:gluetun"

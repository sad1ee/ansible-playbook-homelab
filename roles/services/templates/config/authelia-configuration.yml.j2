---
theme: "auto"

log:
  level: "info" # info, debug, trace

authentication_backend:
  password_change:
    disable: true
  password_reset:
    disable: true
    custom_url: ""
  refresh_interval: "1m"
  ldap:
    implementation: "lldap"
    address: "ldap://lldap:3890"
    base_dn: "DC={{ services_domain_base_seperate.sld }},DC={{ services_domain_base_seperate.tld }}"
    user: "UID=authelia_bind_user,OU=people,DC={{ services_domain_base_seperate.sld }},DC={{ services_domain_base_seperate.tld }}"
    password: "{{ services_authelia_lldap_user_pass }}"

access_control:
  default_policy: "deny"
  rules:
    - domain: "paperless.{{ services_domain_base }}"
      policy: "bypass"
      resources:
      - "^/api([/?].*)?$"
      - "^/static/frontend/en-US/manifest.webmanifest$"
    - domain: "beszel.{{ services_domain_base }}"
      policy: "bypass"
      resources:
      - "^/api([/?].*)?$"
    - domain:
        - "jellyfin.{{ services_domain_base }}"
        - "jellyseer.{{ services_domain_base }}"
        - "cwa.{{ services_domain_base }}"
        - "cwad.{{ services_domain_base }}"
        - "paperless.{{ services_domain_base }}"
      policy: "one_factor"
      subject: ["group:application_user"]
    - domain: "*.{{ services_domain_base }}"
      policy: "one_factor"
      subject: ["group:application_admin"]

session:
  secret: "{{ services_authelia_session_secret }}"
  inactivity: "5m"
  expiration: "1d"
  remember_me: "3M"
  redis:
    host: "redis"
    port: 6379
    database_index: 1
  cookies:
    - domain: "{{ services_domain_base }}"
      authelia_url: "https://authelia.{{ services_domain_base }}"
      default_redirection_url: "https://homepage.{{ services_domain_base }}"

regulation:
  modes:
  - "ip"

storage:
  encryption_key: "{{ services_authelia_storage_key }}"
  postgres:
    address: "tcp://postgres:5432"
    database: "authelia"
    username: "authelia"
    password: "{{ services_authelia_db_pass }}"

notifier:
  disable_startup_check: false
  filesystem:
    filename: "/config/notification.txt"

server:
  endpoints:
    authz:
      forward-auth:
        implementation: "ForwardAuth"

identity_providers:
  oidc:
    hmac_secret: "{{ services_authelia_hmac_secret }}"
    jwks:
      - algorithm: "RS256"
        use: "sig"
        key: |
          {{ services_authelia_jwks_rs256 | trim | indent(10) }}
    authorization_policies:
      allow-all:
        default_policy: "deny"
        rules:
          - policy: "one_factor"
            subject: "group:application_user"
          - policy: "one_factor"
            subject: "group:application_admin"
      allow-admin:
        default_policy: "deny"
        rules:
          - policy: "one_factor"
            subject: "group:application_admin"
    clients:
      - client_id : "beszel"
        client_name: "Beszel"
        client_secret: "{{ services_authelia_client_secret_beszel }}"
        authorization_policy: "allow-admin"
        redirect_uris:
          - "https://beszel.{{ services_domain_base }}/api/oauth2-redirect"
        pre_configured_consent_duration: 3M
        require_pkce: true
        pkce_challenge_method: "S256"

      - client_id : "paperless"
        client_name: "Paperless"
        client_secret: "{{ services_authelia_client_secret_paperless }}"
        authorization_policy: "allow-all"
        redirect_uris:
          - "https://paperless.{{ services_domain_base }}/accounts/oidc/authelia/login/callback/"
        pre_configured_consent_duration: 3M
        require_pkce: true
        pkce_challenge_method: "S256"
